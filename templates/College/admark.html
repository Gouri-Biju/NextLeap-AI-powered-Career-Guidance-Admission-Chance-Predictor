{% extends "collegebase.html" %}
{% block content %}
<style>
    /* Fixed header & footer */
    header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
    }
    footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
    }

    /* Scrollable content */
    .scrollable-content {
        margin-top: 80px;    
        margin-bottom: 80px; 
        height: calc(100vh - 160px);
        overflow-y: auto;
        padding-bottom: 20px;
    }
    .scrollable-content::-webkit-scrollbar {
        display: none;
    }
    .scrollable-content {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* Table styling */
    table.table-bordered th,
    table.table-bordered td {
        border: 1px solid #2c2c2c !important;
    }
    table.table-bordered {
        border: 1px solid #2c2c2c !important;
    }
    table th, table td {
        padding: 12px;
        text-align: center;
        vertical-align: middle;
    }
    thead th {
        position: sticky;
        top: 0;
        z-index: 2;
    }

    /* Form styling */
    .form-control, .form-select {
        border: 1px solid #3D405B;
        box-shadow: none !important;
    }
</style>

<section class="hero-section" id="section_1">
    <!-- Top SVG Wave -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
        <path fill="#3D405B" fill-opacity="1"
              d="M0,224L34.3,192C68.6,160,137,96,206,90.7C274.3,85,343,139,411,144C480,149,549,107,617,122.7C685.7,139,754,213,823,240C891.4,267,960,245,1029,224C1097.1,203,1166,181,1234,160C1302.9,139,1371,117,1406,106.7L1440,96L1440,0L0,0Z"></path>
    </svg>

    <!-- Scrollable Content -->
    <div class="scrollable-content">
        <div class="container">
            <!-- Form Card -->
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                    <div class="bg-white p-5 rounded shadow-lg">
                        <h2 class="text-center mb-4 text-dark">Add Last Admission Details</h2>
                        {%if z%}
                        <form method="post" id="admissionForm" onsubmit="return validateAdmissionForm();">
                            {% csrf_token %}
                            <!-- Course Dropdown -->
                            <div class="mb-3">
                                <label for="course_request" class="form-label">Select Course</label>
                                <select name="course_request" id="course_request" class="form-select" required>
                                    <option value="">-- Select Course --</option>
                                    {% for course in course_requests %}
                                        <option value="{{ course.id }}">{{ course.course.course }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Marks Starting -->
                            <div class="mb-3">
                                <label for="marks_starting" class="form-label">Marks Starting</label>
                                <input type="number" name="marks_starting" id="marks_starting" 
                                       class="form-control" placeholder="Enter starting marks" required value="{{z.marks_starting}}">
                            </div>

                            <!-- Marks Ending -->
                            <div class="mb-3">
                                <label for="marks_ending" class="form-label">Marks Ending</label>
                                <input type="number" name="marks_ending" id="marks_ending" 
                                       class="form-control" placeholder="Enter ending marks" required value="{{z.marks_ending}}">
                            </div>

                            <!-- Submit Button -->
                            <div class="text-center">
                                <button type="submit" name="submit" class="btn btn-primary px-4">
                                    Save Admission Details
                                </button>
                            </div>
                        </form>
                        {%else%}
                         <form method="post" id="admissionForm" onsubmit="return validateAdmissionForm();">
                            {% csrf_token %}
                            <!-- Course Dropdown -->
                            <div class="mb-3">
                                <label for="course_request" class="form-label">Select Course</label>
                                <select name="course_request" id="course_request" class="form-select" required>
                                    <option value="">-- Select Course --</option>
                                    {% for course in course_requests %}
                                        <option value="{{ course.id }}">{{ course.course.course }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Marks Starting -->
                            <div class="mb-3">
                                <label for="marks_starting" class="form-label">Marks Starting</label>
                                <input type="number" name="marks_starting" id="marks_starting" 
                                       class="form-control" placeholder="Enter starting marks" required >
                            </div>

                            <!-- Marks Ending -->
                            <div class="mb-3">
                                <label for="marks_ending" class="form-label">Marks Ending</label>
                                <input type="number" name="marks_ending" id="marks_ending" 
                                       class="form-control" placeholder="Enter ending marks" required >
                            </div>

                            <!-- Submit Button -->
                            <div class="text-center">
                                <button type="submit" name="submit" class="btn btn-primary px-4">
                                    Save Admission Details
                                </button>
                            </div>
                        </form>
                        {%endif%}
                    </div>
                </div>
            </div>

            <!-- Table Card -->
            <div class="row justify-content-center mt-5">
                <div class="col-lg-12">
                    <div class="bg-white p-5 rounded shadow-lg">
                        <h2 class="text-center mb-4 text-dark">Previous Admission Records</h2>
                        {% if records %}
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>#</th>
                                        <th>Course</th>
                                        <th>Marks Starting</th>
                                        <th>Marks Ending</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for record in records %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ record.course_request.course.course }}</td>
                                        <td>{{ record.marks_starting }}</td>
                                        <td>{{ record.marks_ending }}</td>
                                        <td>
                                            <a href="/edit_last_admission/{{ record.id }}" class="btn btn-sm btn-info">Edit</a>
                                            <a href="/delete_last_admission/{{ record.id }}" class="btn btn-sm btn-danger">Delete</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                            <p class="text-center text-muted">No admission records found.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom SVG Wave -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
        <path fill="#ffffff" fill-opacity="1"
              d="M0,224L34.3,192C68.6,160,137,96,206,90.7C274.3,85,343,139,411,144C480,149,549,107,617,122.7C685.7,139,754,213,823,240C891.4,267,960,245,1029,224C1097.1,203,1166,181,1234,160C1302.9,139,1371,117,1406,106.7L1440,96L1440,320L0,320Z"></path>
    </svg>
</section>

<!-- JS Validation -->
<script>
    function validateAdmissionForm() {
        let course = document.getElementById("course_request").value.trim();
        let start = document.getElementById("marks_starting").value.trim();
        let end = document.getElementById("marks_ending").value.trim();

        if (course === "") {
            alert("Please select a course.");
            return false;
        }
        if (start === "" || isNaN(start)) {
            alert("Please enter valid starting marks.");
            return false;
        }
        if (end === "" || isNaN(end)) {
            alert("Please enter valid ending marks.");
            return false;
        }
        if (parseInt(start) >= parseInt(end)) {
            alert("Marks starting must be less than marks ending.");
            return false;
        }
        return true;
    }
</script>
{% endblock %}
